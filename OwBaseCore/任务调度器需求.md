任务调度器完整需求规格说明
1. 核心功能需求
1.1 任务存储与优先级
•	内部维护支持顺序操作的队列结构
•	支持任务优先级设置(int类型，数值越低优先级越高)
•	对相同类型ID的任务只执行最新的一个
•	入队时自动移除相同类型ID的旧任务
1.2 任务定义与执行
•	任务执行函数使用 Func<object, bool> 形式
•	true 表示执行成功，false 或抛出异常均视为失败
•	使用单个线程执行任务，不使用 async/await
•	按优先级顺序处理任务
•	不考虑任务执行超时机制
1.3 失败重试机制
•	所有任务共用相同的重试策略
•	任务失败后按均匀间隔时间(默认1秒)进行重试
•	重试次数可配置，超过限制后记录日志并丢弃任务
1.4 任务查询与管理
•	提供方法查询某个特定类型ID的任务是否在队列中
•	支持从队列中手动移除特定任务的功能
1.5 线程与并发
•	支持多线程高并发提交任务
•	使用 .NET 6 并发数据结构确保线程安全
•	执行任务的单线程推荐使用专用线程而非线程池线程，以避免线程池资源争用
•	队列容量不设上限限制
1.6 服务生命周期
•	支持依赖注入 (Microsoft.Extensions.DependencyInjection)
•	在服务停止时，确保队列中待执行的任务全部完成
•	系统重启后，可以抛弃之前未完成的任务
1.7 日志与监控
•	使用 .NET 6 自带的日志框架记录任务执行情况
•	提供任务执行统计信息，如成功率、平均执行时间等监控指标
•	监控指标仅在内存中维护，不需要持久化
2. 执行流程
2.1 提交任务
•	外部调用提交方法(Enqueue)并指定 typeId、优先级和执行逻辑
•	若已存在相同 typeId 的旧任务，则移除旧任务，保留新任务
2.2 单线程执行
•	在 ProcessAll 方法中，按优先级从队列取出任务
•	判断是否仍为最新任务，若是则执行
•	执行任务并捕获返回值与异常
2.3 重试与放弃
•	任务失败且重试次数未超限，则按固定间隔(1秒)进行重试
•	重试次数达上限，则记录日志并舍弃任务
2.4 结果处理与统计
•	成功或放弃的任务均不再保留，避免堆积
•	记录任务执行结果到监控统计中
3. 非功能需求
3.1 性能要求
•	高并发场景下快速排队与更新任务
•	降低锁争用，优化内部数据结构
3.2 扩展性
•	保留接口以支持未来可能增加的功能
•	预留多线程执行模式的扩展空间
3.3 可维护性
•	代码结构清晰，提供注释和文档
•	完善日志机制，便于问题排查
4. 监控指标
•	队列当前长度
•	任务执行成功率
•	任务平均执行时间
•	任务重试次数统计
•	按任务类型ID分组的执行统计